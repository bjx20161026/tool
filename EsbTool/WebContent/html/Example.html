<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8"> 
	<title>HomePage</title>
	<link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css">
	<link rel="stylesheet" href="https://cdn.datatables.net/1.10.15/css/jquery.dataTables.min.css">
	<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
	<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>	
	<script src="https://cdn.datatables.net/1.10.15/js/jquery.dataTables.min.js"></script>	
</head>

<body>
<script type="text/javascript">
var data;
function openA(){
	ShareXAxis();
	alert(JSON.stringify(data));
	var table = $('#example').DataTable( {
	    data: data,
	    columns: [
	    	{ data: 'ID' },
			{ data: 'CALL_RESULT' },
			{ data: 'SEND_TIME_STAMP' },
			{  data: {
                _:    "MSG_CONTENT.files",
                _:    "MSG_CONTENT.ftp_url",
                sort: "MSG_CONTENT.service_code"
            } },
	    ]
	});
	 $('#example tbody').on( 'click', 'tr', function () {
	        if ( $(this).hasClass('selected') ) {
	            $(this).removeClass('selected');
	        }
	        else {
	            table.$('tr.selected').removeClass('selected');
	            $(this).addClass('selected');
	        }
	    } );
	 
	    $('#button').click( function () {
		var mydata = table.row('.selected').data();
	    alert("mydata"+JSON.stringify(mydata));
	    alert("mydata"+mydata.ID);
	    var url = "http://localhost:8080/EsbTool/rest/dealFile/downloadbyid?ID="+mydata.ID;
	    window.location.href=url;
	    } );
}
function ShareXAxis(){ 
	var sendprotocol = document.getElementById("sendprotocol").value;
    var sendday = document.getElementById("sendday").value;
	       $.ajax({ 
	               async:false,
	               type:"get", 
	               contentType:"application/json", 
	               url:"http://localhost:8080/EsbTool/rest/EsbSend/getMsg?protocol="+sendprotocol+"&day="+sendday,
	               success:function(result){ 
	                   if(result!=null){
	                       data=result;       
	                   } 
	               } 
	         }); 
	   } 
</script>
<br>
	 <p><table>
			<tr>
				<th>规约或文件名</th>
				<th>：</th>
				<td><input id="sendprotocol"></td>
				<th>&nbsp;&nbsp;&nbsp;</th>
				<th>消息时间</th>
				<th>：</th>
				<td><input id="sendday" value="0.1"></td>
				<th>&nbsp;&nbsp;&nbsp;</th>
				<th><button onclick="openA()">查询</button></th>
				<th>&nbsp;&nbsp;&nbsp;</th>
				<th><button id="button">下载</button></th>
			</tr>
		</table>
	 </p>
	 <br>

<table id="example" class="table table-striped table-bordered" cellspacing="0" width="100%">
<thead>
            <tr>
                <th>ID</th>
                <th>CALL_RESULT</th>
                <th>SEND_TIME_STAMP</th>
                <th>MSG_CONTENT</th>
            </tr>
        </thead>
</table>
</body>
</html>